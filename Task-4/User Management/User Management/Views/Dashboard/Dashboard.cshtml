@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor  
<link rel="stylesheet" href="~/css/notification.css" />   
@await Html.PartialAsync("Notification")  
<br />  
<h3>Hi, <b>@HttpContextAccessor.HttpContext.Request.Cookies["name"]?.ToString()</b> </h3>
<br />
<br />
<div class="navbar navbar-expand-lg navbar-light bg-secondary-subtle">  
   <button data-action="Block" class="btn btn-primary me-2">Block</button>  
   <button data-action="Unblock" class="btn btn-secondary me-2">Unblock</button>  
   <button data-action="Delete" class="btn btn-danger">Delete</button>  
</div>  

<table class="table table-bordered">  
   <thead>  
       <tr>  
           <th><input type="checkbox" id="selectAll" title="Select/Deselect all"></th>  
           <th>Name</th>  
           <th>Last seen <i class="bi bi-arrow-down"></i></th>  
           <th>Status</th>  
       </tr>  
   </thead>  
   <tbody>  
       @foreach (var user in Model)  
       {  
           <tr>  
               <td><input type="checkbox" class="select-user" value="@user.UserId"></td>  
               <td>  
                   <div>@user.UserName</div>  
                   <div class="text-muted small">@user.UserEmail</div>  
                   @if (!string.IsNullOrEmpty(user.UserDescription))  
                   {  
                       <div class="small">@user.UserDescription</div>  
                   }  
               </td>  
               <td>@user.LastLogin?.ToString("g")</td>  
               <td>@user.UserStatus</td>  
           </tr>  
       }  
   </tbody>  
</table>  

@section Scripts {  
   <script src="~/lib/jquery/dist/jquery.min.js"></script>  
   <script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>  
   <script>  
       document.addEventListener('DOMContentLoaded', () => {  
           const selectAll = document.getElementById('selectAll');  
           const userCheckboxes = document.querySelectorAll('.select-user');  

           selectAll.addEventListener('change', () => {  
               userCheckboxes.forEach(cb => cb.checked = selectAll.checked);  
           });  

           document.querySelectorAll('[data-action]').forEach(btn => {  
               btn.addEventListener('click', async () => {  
                   const action = btn.dataset.action;  
                   const userIds = [...document.querySelectorAll('.select-user:checked')]  
                       .map(el => parseInt(el.value));  

                   if (!userIds.length) {  
                       toastr.error('Please select at least one user.');  
                       return;  
                   }  

                   if (action === 'Delete' && !confirm(`Confirm ${action} selected users?`)) {  
                       return;  
                   }  

                   try {  
                       const response = await fetch(`/Dashboard/${action}`, {  
                           method: 'POST',  
                           headers: { 'Content-Type': 'application/json' },  
                           body: JSON.stringify(userIds)  
                       });  

                       const result = await response.json();  
                       if (result.success) {  
                           toastr.success(result.message);  
                           setTimeout(() => location.reload(), 1000);  
                       } else {  
                           toastr.error(result.message);  
                       }  
                   } catch {  
                       toastr.error('Action failed. Please try again.');  
                   }  
               });  
           });  
       });  
   </script>  
}